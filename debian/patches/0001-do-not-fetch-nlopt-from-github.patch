From: Tomasz Buchert <tomasz@debian.org>
Date: Tue, 26 Dec 2023 22:56:28 +0100
Subject: do not fetch nlopt from github

---
 plugins/LensDistortionEstimator/src/CMakeLists.txt | 40 ++++++++++++----------
 1 file changed, 21 insertions(+), 19 deletions(-)

diff --git a/plugins/LensDistortionEstimator/src/CMakeLists.txt b/plugins/LensDistortionEstimator/src/CMakeLists.txt
index 52f4aee..eb42ec6 100644
--- a/plugins/LensDistortionEstimator/src/CMakeLists.txt
+++ b/plugins/LensDistortionEstimator/src/CMakeLists.txt
@@ -1,10 +1,12 @@
 FIND_PACKAGE(exiv2)
 
-CPMFindPackage(NAME NLopt
-               URL https://github.com/stevengj/nlopt/archive/refs/tags/v2.7.1.tar.gz
-               URL_HASH SHA256=db88232fa5cef0ff6e39943fc63ab6074208831dc0031cf1545f6ecd31ae2a1a
-               EXCLUDE_FROM_ALL yes
-              )
+find_package(NLopt)
+
+# CPMFindPackage(NAME NLopt
+#               URL https://github.com/stevengj/nlopt/archive/refs/tags/v2.7.1.tar.gz
+#               URL_HASH SHA256=db88232fa5cef0ff6e39943fc63ab6074208831dc0031cf1545f6ecd31ae2a1a
+#               EXCLUDE_FROM_ALL yes
+#              )
 
 INCLUDE_DIRECTORIES(
      .
@@ -53,25 +55,25 @@ if(exiv2_FOUND)
 endif()
 
 TARGET_COMPILE_OPTIONS(LensDistortionEstimator-static PRIVATE "-DHAVE_NLOPT")
-IF(NLopt_ADDED)
-	SET_TARGET_PROPERTIES(nlopt PROPERTIES C_EXTENSIONS ON)
-	ADD_DEPENDENCIES(LensDistortionEstimator-static generate-cpp)
-	TARGET_INCLUDE_DIRECTORIES(LensDistortionEstimator-static
-	                           PRIVATE ${CPM_PACKAGE_NLopt_BINARY_DIR} ${CPM_PACKAGE_NLopt_SOURCE_DIR}/src/api)
-	TARGET_LINK_LIBRARIES(LensDistortionEstimator-static nlopt)
-ELSE()
+# IF(NLopt_ADDED)
+#	SET_TARGET_PROPERTIES(nlopt PROPERTIES C_EXTENSIONS ON)
+#	ADD_DEPENDENCIES(LensDistortionEstimator-static generate-cpp)
+#	TARGET_INCLUDE_DIRECTORIES(LensDistortionEstimator-static
+#	                           PRIVATE ${CPM_PACKAGE_NLopt_BINARY_DIR} ${CPM_PACKAGE_NLopt_SOURCE_DIR}/src/api)
+#	TARGET_LINK_LIBRARIES(LensDistortionEstimator-static nlopt)
+# ELSE()
 	# NLOPT_LIBRARIES variable is not set by CPM (unlike find_package; see
 	# https://github.com/cpm-cmake/CPM.cmake/issues/132), and the imported target
 	# may appear to be NLopt::nlopt or NLopt::nlopt_cxx, and using any one of these
 	# is incompatible with versions of nlopt where the other would be found. So
 	# let's check which one we should use.
-	IF(NLopt_DIR MATCHES "nlopt_cxx$")
-		set(NLOPT_LIBRARIES NLopt::nlopt_cxx)
-	ELSEIF(NLopt_DIR MATCHES "nlopt$")
-		set(NLOPT_LIBRARIES NLopt::nlopt)
-	ENDIF()
-	TARGET_LINK_LIBRARIES(LensDistortionEstimator-static ${NLOPT_LIBRARIES})
-ENDIF()
+	#IF(NLopt_DIR MATCHES "nlopt_cxx$")
+	#	set(NLOPT_LIBRARIES NLopt::nlopt_cxx)
+	#ELSEIF(NLopt_DIR MATCHES "nlopt$")
+	#	set(NLOPT_LIBRARIES NLopt::nlopt)
+	#ENDIF()
+TARGET_LINK_LIBRARIES(LensDistortionEstimator-static ${NLOPT_LIBRARIES})
+# ENDIF()
 
 ADD_DEPENDENCIES(AllStaticPlugins LensDistortionEstimator-static)
 
